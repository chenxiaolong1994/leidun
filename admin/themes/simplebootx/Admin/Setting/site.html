<admintpl file="header" />
</head>
<body>
	<div class="wrap js-check-wrap">
		<ul class="nav nav-tabs">
			<li class="active"><a href="#A" data-toggle="tab">{:L('WEB_SITE_INFOS')}</a></li>
			<li><a href="#B" data-toggle="tab">{:L('SEO_SETTING')}</a></li>
			<li><a href="#C" data-toggle="tab">{:L('URL_SETTING')}</a></li>
			<li><a href="{:U('route/index')}">URL美化</a></li>
			<li><a href="#D" data-toggle="tab">支付宝配置</a></li>
			<li><a href="#E" data-toggle="tab">云存储配置</a></li>
			<li><a href="#F" data-toggle="tab">云直播配置</a></li>
			<li><a href="#G" data-toggle="tab">短信验证码配置</a></li>
		</ul>
		<form class="form-horizontal js-ajax-form" action="{:U('setting/site_post')}" method="post">
			<fieldset>
				<div class="tabbable">
					<div class="tab-content">
						<div class="tab-pane active" id="A">
							<fieldset>
								<div class="control-group">
									<label class="control-label">{:L('WEBSITE_NAME')}</label>
									<div class="controls">
										<input type="text" name="options[site_name]" value="{$site_name}"><span class="form-required">*</span>
										<php>if($option_id):</php>
										<input type="hidden" name="option_id" value="{$option_id}">
										<php>endif;</php>
									</div>
								</div>
								<div class="control-group">
									<label class="control-label">{:L('WEBSITE_DOMAIN')}</label>
									<div class="controls">
										<input type="text" name="options[site_host]" value="{$site_host}"><span class="form-required">*</span>
									</div>
								</div>
								<div class="control-group">
									<label class="control-label">客服电话</label>
									<div class="controls">
										<input type="text" name="options[kefu_tel]" value="{$kefu_tel}"><span class="form-required">*</span>
									</div>
								</div>
								<div class="control-group">
									<label class="control-label">后台地址加密码：</label>
									<div class="controls">
										<input type="text" name="options[site_admin_url_password]" value="{$site_admin_url_password}" id="js-site-admin-url-password"><span class="form-required">*</span>
										<span class="help-block" style="color: red;">设置加密码后必须通过以下地址访问后台,请劳记此地址，为了安全，您也可以定期更换此加密码!</span>
										<php>$site_admin_url_password =C("SP_SITE_ADMIN_URL_PASSWORD");</php>
										<if condition="!empty($site_admin_url_password)">
										<span class="help-block">后台地址：<span id="js-site-admin-url">{:sp_get_host()}__ROOT__?g=admin&upw={:C('SP_SITE_ADMIN_URL_PASSWORD')}</span></span>
										</if>
									</div>
								</div>
								<div class="control-group">
									<label class="control-label">{:L('WEBSITE_THEME')}</label>
									<div class="controls">
										<select name="options[site_tpl]">
											<foreach name="templates" item="vo">
											<php>$tpl_selected=$site_tpl==$vo?"selected":"";</php>
											<option value="{$vo}" {$tpl_selected}>{$vo}</option>
											</foreach>
										</select>
									</div>
								</div>
								<!-- <div class="control-group">
									<label class="control-label">{:L('ENABLE_MOBILE_THEME')}：</label>
									<div class="controls">
										<php>$mobile_tpl_enabled_checked=empty($mobile_tpl_enabled)?'':'checked';</php>
										<label class="checkbox inline"><input type="checkbox" name="options[mobile_tpl_enabled]" value="1" {$mobile_tpl_enabled_checked}></label>
									</div>
								</div> -->
								<div class="control-group">
									<label class="control-label">{:L('WEBSITE_ADMIN_THEME')}</label>
									<div class="controls">
										<select name="options[site_adminstyle]">
											<foreach name="adminstyles" item="vo">
											<php>$adminstyle_selected=$site_adminstyle==$vo?"selected":"";</php>
											<option value="{$vo}" {$adminstyle_selected}>{$vo}</option>
											</foreach>
										</select>
									</div>
								</div>
								<div class="control-group">
									<label class="control-label">{:L('HTML_CACHE')}：</label>
									<div class="controls">
										<php>$html_cache_on_checked=empty($html_cache_on)?'':'checked';</php>
										<label class="checkbox inline"><input type="checkbox" name="options[html_cache_on]" value="1" {$html_cache_on_checked}></label>
									</div>
								</div>
								<div class="control-group">
									<label class="control-label">{:L('WEBSITE_ICP')}</label>
									<div class="controls">
										<input type="text" name="options[site_icp]" value="{$site_icp}">
									</div>
								</div>
								
								<div class="control-group">
									<label class="control-label">{:L('WEBMASTER_EMAIL')}</label>
									<div class="controls">
										<input type="text" name="options[site_admin_email]" value="{$site_admin_email}">
									</div>
								</div>
								<div class="control-group">
									<label class="control-label">{:L("WEBSITE_STATISTICAL_CODE")}</label>
									<div class="controls">
										<textarea name="options[site_tongji]" rows="5" cols="57">{$site_tongji}</textarea>
									</div>
								</div>
								<div class="control-group">
									<label class="control-label">{:L('WEBSITE_COPYRIGHT_INFOMATION')}</label>
									<div class="controls">
										<textarea name="options[site_copyright]" rows="5" cols="57">{$site_copyright}</textarea>
									</div>
								</div>
							</fieldset>
						</div>
						<div class="tab-pane" id="B">
							<fieldset>
								<div class="control-group">
									<label class="control-label">{:L('WEBSITE_SEO_TITLE')}</label>
									<div class="controls">
										<input type="text" name="options[site_seo_title]" value="{$site_seo_title}">
									</div>
								</div>
								<div class="control-group">
									<label class="control-label">{:L('WEBSITE_SEO_KEYWORDS')}</label>
									<div class="controls">
										<input type="text" name="options[site_seo_keywords]" value="{$site_seo_keywords}">
									</div>
								</div>
								<div class="control-group">
									<label class="control-label">{:L('WEBSITE_SEO_DESCRIPTION')}</label>
									<div class="controls">
										<textarea name="options[site_seo_description]" rows="5" cols="57">{$site_seo_description}</textarea>
									</div>
								</div>
							</fieldset>
						</div>
						<div class="tab-pane" id="C">
							<fieldset>
								<div class="control-group">
									<label class="control-label">{:L('URL_MODE')}</label>
									<div class="controls">
										<php>$urlmodes=array( "0"=>L('URL_NORMAL_MODE'), "1"=>L('URL_PATHINFO_MODE'), "2"=>L('URL_REWRITE_MODE'));</php>
										<select name="options[urlmode]">
											<foreach name="urlmodes" item="vo">
											<php>$urlmode_selected=$key==$urlmode?"selected":"";</php>
											<option value="{$key}" {$urlmode_selected}>{$vo}</option>
											</foreach>
										</select>
										<span class="form-required">* {:L('URL_MODE_HELP_TEXT')}</span>
									</div>
								</div>
								<div class="control-group">
									<label class="control-label">{:L('URL_REWRITE_SUFFIX')}</label>
									<div class="controls">
										<input type="text" name="options[html_suffix]" value="{$html_suffix}">
										<span class="form-required">{:L('URL_REWRITE_SUFFIX_HELP_TEXT')}</span>
									</div>
								</div>
							</fieldset>
						</div>
						<div class="tab-pane" id="D">
							<div class="control-group">
									<label class="control-label">支付宝收款账号</label>
									<div class="controls">
										<input type="text" style="width:500px" name="options[seller_email]" value="{$alipayconfig['seller_email']}">
									</div>
								</div>
								<div class="control-group">
									<label class="control-label">支付宝key</label>
									<div class="controls">
										<input type="text" style="width:500px" name="options[key]" value="{$alipayconfig['key']}">
									</div>
								</div>
								<div class="control-group">
									<label class="control-label">支付宝partner</label>
									<div class="controls">
										<input type="text" style="width:500px" name="options[partner]" value="{$alipayconfig['partner']}">
									</div>
								</div>
								<div class="control-group">
									<label class="control-label">notify_url</label>
									<div class="controls">
										<input type="text" style="width:500px" name="options[notify_url]" value="{$alipayconfig['notify_url']}">只需修改域名即可
									</div>
								</div>
								<div class="control-group">
									<label class="control-label">return_url</label>
									<div class="controls">
										<input type="text" style="width:500px" name="options[return_url]" value="{$alipayconfig['return_url']}">只需修改域名即可
									</div>
								</div>
								<div class="control-group">
									<label class="control-label">successpage</label>
									<div class="controls">
										<input type="text" style="width:500px" name="options[successpage]" value="{$alipayconfig['successpage']}">只需修改域名即可
									</div>
								</div>
								<div class="control-group">
									<label class="control-label">errorpage</label>
									<div class="controls">
										<input type="text" style="width:500px" name="options[errorpage]" value="{$alipayconfig['errorpage']}">只需修改域名即可
									</div>
								</div>
							</div>
							<php>
							    $qcloud1=$radio['yuntype']=='qcloud'?"checked":"";
							    $wsview1=$radio['yuntype']=='wsview'?"checked":"";
								$qcloudlive=$radio['livetype']=='qcloudlive'?"checked":"";
							    $wsviewlive=$radio['livetype']=='wsviewlive'?"checked":"";
								$mobileverify1=$radio['mobileverify']=='1'?"checked":"";
							    $mobileverify0=$radio['mobileverify']=='0'?"checked":"";
								$qcloudlivedisplay=$radio['livetype']=='qcloudlive'?"style='display:;'":"style='display:none;'";
								$wsviewlivedisplay=$radio['livetype']=='wsviewlive'?"style='display:;'":"style='display:none;'";
								$qclouddisplay=$radio['yuntype']=='qcloud'?"style='display:;'":"style='display:none;'";
								$wsviewdisplay=$radio['yuntype']=='wsview'?"style='display:;'":"style='display:none;'";
							</php>
							<div class="tab-pane" id="E">
						
								<div class="control-group" id="video" style="background:#f5f5f5;height:40px;line-height40px;">
									<label class="control-label">视频存储位置</label>
									<label class="control-label">
										<input type="radio" name="radio1" {$qcloud1}  value="qcloud"  onchange="radioSwitch(this)" >&nbsp&nbsp&nbsp&nbsp
										腾讯cos
									</label>
									<label class="control-label">
										<input type="radio" name="radio1" {$wsview1} value="wsview"  onchange="radioSwitch(this)">&nbsp&nbsp&nbsp&nbsp
										万视无忧
									</label>  
								</div>
						       
								<div id="qcloud" {$qclouddisplay}>
								   <div class="control-group">
										<label class="control-label">APP_ID</label>
										<div class="controls">
											<input type="text" style="width:300px" name="options[APP_ID]" value="{$tencent['APP_ID']}">
										</div>
									</div>
									<div class="control-group">
										<label class="control-label">SECRET_ID</label>
										<div class="controls">
											<input type="text" style="width:300px" name="options[SECRET_ID]" value="{$tencent['SECRET_ID']}">
										</div>
									</div>
									<div class="control-group">
										<label class="control-label">SECRET_KEY</label>
										<div class="controls">
											<input type="text" style="width:300px" name="options[SECRET_KEY]" value="{$tencent['SECRET_KEY']}">
										</div>
									</div>
									<div class="control-group">
										<label class="control-label">域名空间</label>
										<div class="controls">
											<input type="text" style="width:300px" name="options[DOMAIN]" value="{$tencent['DOMAIN']}">
										</div>
									</div>
								</div>
								<div id="wsview" {$wsviewdisplay}>
								    <div class="control-group">
										<label class="control-label">用户名</label>
										<div class="controls">
											<input type="text" style="width:300px" name="options[wsviewname]" value="{$wsview['name']}">
										</div>
									</div>
									<div class="control-group">
										<label class="control-label">密码</label>
										<div class="controls">
											<input type="text" style="width:300px" name="options[wsviewpass]" value="{$wsview['pass']}">
										</div>
									</div>
								</div>
								
						</div>
						
						<div class="tab-pane" id="F">
						    <div class="control-group" id="video" style="background:#f5f5f5;height:40px;line-height40px;">
									<label class="control-label">直播平台</label>
									<label class="control-label">
										<input type="radio" name="radio"  value="qcloudlive" {$qcloudlive} onchange="radioSwitch2(this)" >&nbsp&nbsp&nbsp&nbsp
										腾讯直播
									</label>
									<label class="control-label">
										<input type="radio" name="radio"  value="wsviewlive" {$wsviewlive} onchange="radioSwitch2(this)">&nbsp&nbsp&nbsp&nbsp
										万视无忧直播
									</label>  
							</div>
							<div id="qcloudlive" {$qcloudlivedisplay}>
								<div class="control-group">
									<label class="control-label">SecretKey</label>
									<div class="controls">
										<input type="text" style="width:300px" name="options[SecretKey]" value="{$tencent['SecretKey']}">
									</div>
								</div>
								<div class="control-group">
									<label class="control-label">SecretId</label>
									<div class="controls">
										<input type="text" style="width:300px" name="options[SecretId]" value="{$tencent['SecretId']}">
									</div>
								</div>
								<div class="control-group">
									<label class="control-label">AppId</label>
									<div class="controls">
										<input type="text" style="width:300px" name="options[AppId]" value="{$tencent['AppId']}">
									</div>
								</div>
							</div>	
							<div id="wsviewlive" {$wsviewlivedisplay}>
							     <div class="control-group">
									<label class="control-label">用户名</label>
									<div class="controls">
										<input type="text" style="width:300px" name="options[wsviewname2]" value="{$wsview['name2']}">
									</div>
								</div>
								<div class="control-group">
									<label class="control-label">密码</label>
									<div class="controls">
										<input type="text" style="width:300px" name="options[wsviewpass2]" value="{$wsview['pass2']}">
									</div>
								</div>
							</div>	
							
						</div>
						<div class="tab-pane" id="G">
						    <div class="control-group" id="video" style="background:#f5f5f5;height:40px;line-height40px;">
									<label class="control-label">是否开启短信验证码</label>
									<label class="control-label">
										<input type="radio" name="radio3"  value="1" {$mobileverify1} >&nbsp&nbsp&nbsp&nbsp
										是
									</label>
									<label class="control-label">
										<input type="radio" name="radio3"  value="0" {$mobileverify0} >&nbsp&nbsp&nbsp&nbsp
										否
									</label>  
							</div>
							<div id="qcloudlive" >
								<div class="control-group">
									<label class="control-label">App_Key</label>
									<div class="controls">
										<input type="text" style="width:300px" name="options[alidayu_app_key]" value="{$alidayu['alidayu_app_key']}">
									</div>
								</div>
								<div class="control-group">
									<label class="control-label">App_Secret</label>
									<div class="controls">
										<input type="text" style="width:300px" name="options[alidayu_app_secret]" value="{$alidayu['alidayu_app_secret']}">
									</div>
								</div>
								<div class="control-group">
									<label class="control-label">签名</label>
									<div class="controls">
										<input type="text" style="width:300px" name="options[smsFreeSignName]" value="{$alidayu['smsFreeSignName']}">
									</div>
								</div>
								<div class="control-group">
									<label class="control-label">模板ID</label>
									<div class="controls">
										<input type="text" style="width:300px" name="options[smsTemplateCode]" value="{$alidayu['smsTemplateCode']}">
									</div>
								</div>
							</div>	
							
						</div>
					</div>
				</div>

				<div class="form-actions">
					<button type="submit" class="btn btn-primary  js-ajax-submit">{:L("SAVE")}</button>
				</div>
			</fieldset>
		</form>

	</div>
	<script type="text/javascript" src="__PUBLIC__/js/common.js"></script>
	<script>
		/////---------------------
		$(function(){
			$("#urlmode-select").change(function(){
				if($(this).val()==1){
					alert("更改后，若发现前台链接不能正常访问，可能是您的服务器不支持PATHINFO，请先修改data/conf/config.php文件的URL_MODEL为0保证网站正常运行,在配置服务器PATHINFO功能后再更新为PATHINFO模式！");
				}
				
				if($(this).val()==2){
					alert("更改后，若发现前台链接不能正常访问，可能是您的服务器不支持REWRITE，请先修改data/conf/config.php文件的URL_MODEL为0保证网站正常运行，在开启服务器REWRITE功能后再更新为REWRITE模式！");
				}
			});
			$("#js-site-admin-url-password").change(function(){
				$(this).data("changed",true);
			});
		});
		Wind.use('validate', 'ajaxForm', 'artDialog', function() {
			//javascript
			var form = $('form.js-ajax-forms');
			//ie处理placeholder提交问题
			if ($.browser.msie) {
				form.find('[placeholder]').each(function() {
					var input = $(this);
					if (input.val() == input.attr('placeholder')) {
						input.val('');
					}
				});
			}
			//表单验证开始
			form.validate({
				//是否在获取焦点时验证
				onfocusout : false,
				//是否在敲击键盘时验证
				onkeyup : false,
				//当鼠标掉级时验证
				onclick : false,
				//验证错误
				showErrors : function(errorMap, errorArr) {
					//errorMap {'name':'错误信息'}
					//errorArr [{'message':'错误信息',element:({})}]
					try {
						$(errorArr[0].element).focus();
						art.dialog({
							id : 'error',
							icon : 'error',
							lock : true,
							fixed : true,
							background : "#CCCCCC",
							opacity : 0,
							content : errorArr[0].message,
							cancelVal : "{:L('OK')}",
							cancel : function() {
								$(errorArr[0].element).focus();
							}
						});
					} catch (err) {
					}
				},
				//验证规则
				rules : {
					'options[site_name]' : {
						required : 1
					},
					'options[site_host]' : {
						required : 1
					},
					'options[site_root]' : {
						required : 1
					}
				},
				//验证未通过提示消息
				messages : {
					'options[site_name]' : {
						required : "{:L('WEBSITE_SITE_NAME_REQUIRED_MESSAGE')}"
					},
					'options[site_host]' : {
						required : "{:L('WEBSITE_SITE_HOST_REQUIRED_MESSAGE')}"
					}
				},
				//给未通过验证的元素加效果,闪烁等
				highlight : false,
				//是否在获取焦点时验证
				onfocusout : false,
				//验证通过，提交表单
				submitHandler : function(forms) {
					$(forms).ajaxSubmit({
						url : form.attr('action'), //按钮上是否自定义提交地址(多按钮情况)
						dataType : 'json',
						beforeSubmit : function(arr, $form, options) {

						},
						success : function(data, statusText, xhr, $form) {
							if (data.status) {
								setCookie("refersh_time", 1);
								var admin_url_changed=$("#js-site-admin-url-password").data("changed");
								var message =admin_url_changed?data.info+'<br><span style="color:red;">后台地址已更新(请劳记！)</span>':data.info;
								
								//添加成功
								Wind.use("artDialog", function() {
									art.dialog({
										id : "succeed",
										icon : "succeed",
										fixed : true,
										lock : true,
										background : "#CCCCCC",
										opacity : 0,
										content : message,
										button : [ {
											name : "{:L('OK')}",
											callback : function() {
												reloadPage(window);
												return true;
											},
											focus : true
										}, {
											name : "{:L('CLOSE')}",
											callback : function() {
												reloadPage(window);
												return true;
											}
										} ]
									});
								});
							} else {
								alert(data.info);
							}
						}
					});
				}
			});
		});
		////-------------------------
	</script>
	<script>
	function radioSwitch(){
		var val = $('#video input[name="radio1"]:checked ').val();
		if(val=='qcloud'){
			document.getElementById("wsview").style.display="none";
            document.getElementById("qcloud").style.display="";  
		}
		if(val=='wsview'){
			document.getElementById("wsview").style.display="";
            document.getElementById("qcloud").style.display="none";	
		}
	}
	function radioSwitch2(){
		var val = $('#video input[name="radio"]:checked ').val();
		if(val=='qcloudlive'){
			document.getElementById("wsviewlive").style.display="none";
            document.getElementById("qcloudlive").style.display="";  
		}
		if(val=='wsviewlive'){
			document.getElementById("wsviewlive").style.display="";
            document.getElementById("qcloudlive").style.display="none";	
		}
	}
</script>  
</body>
</html>